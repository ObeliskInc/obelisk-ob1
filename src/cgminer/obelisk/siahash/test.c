// Test file to verify that the library is correct.

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include "siaverify.h"

int main(void) {
	printf("Starting verification tests\n");

	// Known Valid:
	uint8_t testOneHeader[80] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x6f, 0x8b, 0xb8, 0x8b, 0xf6, 0x7e, 0x19, 0x4a, 0xc2, 0x06, 0x4b, 0xb4, 0x16, 0x5f, 0x90, 0x04, 0x5d, 0x84, 0x46, 0x97, 0xab, 0x37, 0x1a, 0xd0, 0x5f, 0x98, 0x33, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x17, 0x7e, 0x55, 0x00, 0x00, 0x00, 0x00, 0x89, 0x4e, 0x20, 0x2a, 0x44, 0x1b, 0x79, 0xa7, 0x67, 0x6b, 0xb5, 0x7f, 0x61, 0xd7, 0x7f, 0x8c, 0xfb, 0x6c, 0x3d, 0xca, 0x6d, 0xd6, 0x0c, 0xa8, 0xc8, 0x92, 0x4d, 0xbb, 0xcb, 0x74, 0x8c, 0x6b};
	bool testOneResult = siaHeaderMeetsMinimumTarget(testOneHeader);
	if(testOneResult) {
		printf("Test one passed.\n");
	} else {
		printf("TEST ONE HAS FAILED\n");
		printf("TEST ONE HAS FAILED\n");
		printf("TEST ONE HAS FAILED\n");
	}

	// Known Invalid:
	//
	// Made invalid by tweaking 1 character of the valid hash.
	uint8_t testTwoHeader[80] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x6f, 0x8b, 0xb8, 0x8b, 0xf6, 0x7e, 0x19, 0x4a, 0xc2, 0x06, 0x4b, 0xb4, 0x16, 0x5f, 0x90, 0x04, 0x5d, 0x84, 0x46, 0x97, 0xab, 0x37, 0x1a, 0xd0, 0x5f, 0x98, 0x33, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x17, 0x7e, 0x55, 0x00, 0x00, 0x00, 0x00, 0x89, 0x4e, 0x20, 0x2a, 0x44, 0x1b, 0x79, 0xa7, 0x67, 0x6c, 0xb5, 0x7f, 0x61, 0xd7, 0x7f, 0x8c, 0xfb, 0x6c, 0x3d, 0xca, 0x6d, 0xd6, 0x0c, 0xa8, 0xc8, 0x92, 0x4d, 0xbb, 0xcb, 0x74, 0x8c, 0x6b};
	bool testTwoResult = siaHeaderMeetsMinimumTarget(testTwoHeader);
	if(!testTwoResult) {
		printf("Test two passed.\n");
	} else {
		printf("TEST TWO HAS FAILED\n");
		printf("TEST TWO HAS FAILED\n");
		printf("TEST TWO HAS FAILED\n");
	}

	// Known valid, meets a 40k difficulty.
	uint8_t testThreeHeader[80] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x6f, 0x8b, 0xb8, 0x8b, 0xf6, 0x7e, 0x19, 0x4a, 0xc2, 0x06, 0x4b, 0xb4, 0x16, 0x5f, 0x90, 0x04, 0x5d, 0x84, 0x46, 0x97, 0xab, 0x37, 0x1a, 0xd0, 0x5f, 0x98, 0x33, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x17, 0x7e, 0x55, 0x00, 0x00, 0x00, 0x00, 0x89, 0x4e, 0x20, 0x2a, 0x44, 0x1b, 0x79, 0xa7, 0x67, 0x6b, 0xb5, 0x7f, 0x61, 0xd7, 0x7f, 0x8c, 0xfb, 0x6c, 0x3d, 0xca, 0x6d, 0xd6, 0x0c, 0xa8, 0xc8, 0x92, 0x4d, 0xbb, 0xcb, 0x74, 0x8c, 0x6b};
	bool testThreeResult = siaHeaderMeetsProvidedDifficulty(testThreeHeader, 40000); // 40k difficulty.
	if (testThreeResult) {
		printf("Test three passed.\n");
	} else {
		printf("TEST THREE FAILED\n");
		printf("TEST THREE FAILED\n");
		printf("TEST THREE FAILED\n");
	}

	// Known valid, does not meet a 60k difficulty.
	uint8_t testFourHeader[80] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x6f, 0x8b, 0xb8, 0x8b, 0xf6, 0x7e, 0x19, 0x4a, 0xc2, 0x06, 0x4b, 0xb4, 0x16, 0x5f, 0x90, 0x04, 0x5d, 0x84, 0x46, 0x97, 0xab, 0x37, 0x1a, 0xd0, 0x5f, 0x98, 0x33, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x17, 0x7e, 0x55, 0x00, 0x00, 0x00, 0x00, 0x89, 0x4e, 0x20, 0x2a, 0x44, 0x1b, 0x79, 0xa7, 0x67, 0x6b, 0xb5, 0x7f, 0x61, 0xd7, 0x7f, 0x8c, 0xfb, 0x6c, 0x3d, 0xca, 0x6d, 0xd6, 0x0c, 0xa8, 0xc8, 0x92, 0x4d, 0xbb, 0xcb, 0x74, 0x8c, 0x6b};
	bool testFourResult = siaHeaderMeetsProvidedDifficulty(testFourHeader, 60000); // 60k difficulty.
	if (!testFourResult) {
		printf("Test four passed.\n");
	} else {
		printf("TEST FOUR FAILED\n");
		printf("TEST FOUR FAILED\n");
		printf("TEST FOUR FAILED\n");
	}

	// Known invalid, does not meet a 60k difficulty.
	uint8_t testFiveHeader[80] = {0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x6f, 0x8b, 0xb8, 0x8b, 0xf6, 0x7e, 0x19, 0x4a, 0xc2, 0x06, 0x4b, 0xb4, 0x16, 0x5f, 0x90, 0x04, 0x5d, 0x84, 0x46, 0x97, 0xab, 0x37, 0x1a, 0xd0, 0x5f, 0x98, 0x33, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x17, 0x7e, 0x55, 0x00, 0x00, 0x00, 0x00, 0x89, 0x4e, 0x20, 0x2a, 0x44, 0x1b, 0x79, 0xa7, 0x67, 0x6b, 0xb5, 0x7f, 0x61, 0xd7, 0x7f, 0x8c, 0xfb, 0x6c, 0x3d, 0xca, 0x6d, 0xd6, 0x0c, 0xa8, 0xc8, 0x92, 0x4d, 0xbb, 0xcb, 0x74, 0x8c, 0x6b};
	bool testFiveResult = siaHeaderMeetsProvidedDifficulty(testFiveHeader, 60000); // 40k difficulty.
	if (!testFiveResult) {
		printf("Test five passed.\n");
	} else {
		printf("TEST FIVE FAILED\n");
		printf("TEST FIVE FAILED\n");
		printf("TEST FIVE FAILED\n");
	}

	printf("Verfication tests complete\n");
	return 0;
}

/*

func TestConstructJob(t *testing.T) {
//////////////////////////////////////////////
			30000003

			(*pool.MiningNotify)(0xc4206fe2d0)({
		 Params: ([9]interface {}) (len=9 cap=9) {
		  (string) (len=5) "slux3",
		  (string) (len=64) "0000000000000004c42043d0ebeffbf13afdf842bb36db087d0f849a0df7ef26",
		  (string) (len=208) "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000030000000000000004e6f6e536961000000000000000000004c55584f5200005349503100007cbd820800000000000000",
		  (string) (len=16) "0000000000000000",
		  ([]string) (len=2 cap=4) {
		   (string) (len=64) "ab3c7a1e77b509ef3007f24a55e2335877330676b83b09229483007f5fc99516",
		   (string) (len=64) "1ea43283583790dc0cd653ae920fc78a4edbce50a4c0fbe9ff7fd5581043e395"
		  },
		  (string) "",
		  (string) (len=8) "19089570",
		  (string) (len=16) "e950695b00000000",
		  (bool) true
		 }
		})


			(*pool.SubmitShareParams)(0xc420564960)({
			User: (string) (len=81) "0ded9676c5c22351a1c6e99a19f570cd4f1e00b01406422311aa18b74cb7c9b4972f2148f9d6.test",
			JobId: (string) (len=5) "slux3",
			ExtraNonce2: (string) (len=8) "00000000",
			NTime: (string) (len=16) "e950695b00000000",
			Nonce: (string) (len=16) "2392ba4500000000"
			})
	/////////////////////////////////////////////////
	sBox := SiaBox{}

	merkleBranch := []string{"ab3c7a1e77b509ef3007f24a55e2335877330676b83b09229483007f5fc99516", "1ea43283583790dc0cd653ae920fc78a4edbce50a4c0fbe9ff7fd5581043e395"}
	coinb1 := "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000030000000000000004e6f6e536961000000000000000000004c55584f5200005349503100007cbd820800000000000000"
	coinb2 := "0000000000000000"

	eNonce1 := "30000003" // we give you this
	eNonce2 := "00000000" // you're looking for this

	arbTx := coinb1 + eNonce1 + eNonce2 + coinb2
	root := sBox.BuildMerkleRoot(merkleBranch, arbTx)
	prevHash := "0000000000000004c42043d0ebeffbf13afdf842bb36db087d0f849a0df7ef26"
	nonce := "2392ba4500000000"
	nTime := "e950695b00000000"

	_, hash, header, _ := BuildHeader(prevHash, nonce, nTime, root)
	if hash != "0c0974ca186c24382717a23740224efaf98561f111beee6ed240f9717985471a" {
		t.Errorf("Did not get correct hash: %s", hash)
	}
	if header != "0000000000000004c42043d0ebeffbf13afdf842bb36db087d0f849a0df7ef262392ba4500000000e950695b000000005be8d7f002bea10000eddfb1d12e456c9a8d1e8969063229f0299d7c4629d52b" {
		t.Errorf("Did not get correct header: %s", header)
	}

}

*/
